<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>0x Agency — Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;background:#f6f7fb;color:#222}
    header{background:#4b2ad6;color:#fff;padding:18px 22px}
    h1{margin:0;font-size:20px}
    .wrap{max-width:1100px;margin:20px auto;padding:0 16px}
    .controls{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:14px}
    select,input{padding:8px 10px;border:1px solid #ddd;border-radius:8px;font-size:14px}
    table{width:100%;border-collapse:collapse;background:#fff;border-radius:12px;overflow:hidden;box-shadow:0 4px 12px rgba(0,0,0,.05)}
    th,td{padding:12px 10px;border-bottom:1px solid #f0f0f0;font-size:13px;text-align:left;vertical-align:top}
    th{background:#fafbff;font-weight:700;color:#333}
    .pill{display:inline-block;padding:4px 8px;border-radius:999px;font-size:12px;font-weight:600}
    .pill.pending{background:#fff5d6;color:#a35b00;border:1px solid #ffe29e}
    .pill.verified{background:#e9fff0;color:#0a7a3f;border:1px solid #bff0d1}
    .muted{color:#777}
    .nowrap{white-space:nowrap}
  </style>
</head>
<body>
  <header>
    <h1>0x Agency — Admin Dashboard</h1>
  </header>
  <div class="wrap">
    <div class="controls">
      <select id="status">
        <option value="">All</option>
        <option value="pending">Pending</option>
        <option value="verified">Verified</option>
      </select>
      <input type="search" id="q" placeholder="Search KYC ID, name, email, company…" />
      <button id="refresh">Refresh</button>
    </div>
    <table>
      <thead>
        <tr>
          <th>KYC ID</th>
          <th>Name / Email</th>
          <th>Company</th>
          <th>Project Type</th>
          <th>Status</th>
          <th class="nowrap">Created</th>
          <th class="nowrap">Verified</th>
        </tr>
      </thead>
      <tbody id="rows">
        <tr><td colspan="7" class="muted">Loading…</td></tr>
      </tbody>
    </table>
  </div>

  <script>
    const rows = document.getElementById('rows');
    const statusSel = document.getElementById('status');
    const qInput = document.getElementById('q');
    const btn = document.getElementById('refresh');

    async function load() {
      const params = new URLSearchParams();
      if (statusSel.value) params.set('status', statusSel.value);
      if (qInput.value.trim()) params.set('q', qInput.value.trim());

      rows.innerHTML = `<tr><td colspan="7" class="muted">Loading…</td></tr>`;

      try {
        const res = await fetch(`/api/admin/clients?` + params.toString(), { credentials: 'same-origin' });
        const data = await res.json();
        const items = data.items || [];
        if (!items.length) {
          rows.innerHTML = `<tr><td colspan="7" class="muted">No records</td></tr>`;
          return;
        }
        rows.innerHTML = items.map(it => `
          <tr>
            <td><strong>${it.kycId || '-'}</strong></td>
            <td>
              <div>${it.fullname || '-'}</div>
              <div class="muted">${it.email || '-'}</div>
            </td>
            <td>${it.company || '-'}</td>
            <td>${it.projectType || '-'}</td>
            <td>
              <span class="pill ${it.status === 'verified' ? 'verified' : 'pending'}">
                ${it.status === 'verified' ? 'Verified' : 'Pending'}
              </span>
            </td>
            <td class="nowrap">${it.createdAt ? new Date(it.createdAt).toLocaleString() : '-'}</td>
            <td class="nowrap">${it.verifiedAt ? new Date(it.verifiedAt).toLocaleString() : '-'}</td>
          </tr>
        `).join('');
      } catch (e) {
        rows.innerHTML = `<tr><td colspan="7" class="muted">Error loading data</td></tr>`;
      }
    }

    btn.onclick = load;
    statusSel.onchange = load;
    qInput.onkeydown = (e) => { if (e.key === 'Enter') load(); };

    load();
  </script>
</body>
</html>
